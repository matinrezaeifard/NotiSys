let currentUser=null;const InitMode={'FULL_INIT':'FULL_INIT','HALF_INIT':'HALF_INIT'};function updateTime(){const _0x439e7d=new Date(),_0x5a5122=[translate[lang]['sunday'],translate[lang]['monday'],translate[lang]['tuesday'],translate[lang]['wednsday'],translate[lang]['thursday'],translate[lang]['friday'],translate[lang]['saturday']],_0x1e2ec5=_0x5a5122[_0x439e7d['getDay']()],_0x4486eb=lang==='fa'?'fa-IR':'en-US',_0x1b64ef=_0x439e7d['toLocaleDateString'](_0x4486eb),_0x535bce=_0x439e7d['toLocaleTimeString'](_0x4486eb);document['getElementById']('datetime')['textContent']=_0x1e2ec5+'،\x20'+_0x1b64ef+'\x20-\x20'+_0x535bce;}const tabButtons=document['querySelectorAll']('.tab-btn'),tabContents=document['querySelectorAll']('.tab-content');tabButtons['forEach'](_0x1b37f7=>{_0x1b37f7['addEventListener']('click',()=>{tabButtons['forEach'](_0x184f5a=>_0x184f5a['classList']['remove']('active')),tabContents['forEach'](_0x24bc18=>_0x24bc18['classList']['add']('hidden')),_0x1b37f7['classList']['add']('active'),document['getElementById'](_0x1b37f7['dataset']['tab'])['classList']['remove']('hidden');});});const annDialog=document['getElementById']('announcement-dialog');document['getElementById']('add-announcement')['addEventListener']('click',()=>{annDialog['classList']['remove']('hidden');const _0x1a7dd3=annDialog['querySelector']('form');_0x1a7dd3['noValidate']=![];});function closeAnnouncementDialog(){annDialog['classList']['add']('hidden');const _0x3eaa5e=annDialog['querySelector']('form');_0x3eaa5e['noValidate']=!![],_0x3eaa5e['reset']();}async function deleteAnnouncement(_0x4aaf61){showYesOrNoAlert(translate[lang]['confirmDeleteAnnouncement'])['then'](async _0x207f1c=>{if(!_0x207f1c)return;try{const _0x5558cb=await fetch('/api/announcements/delete',{'method':'DELETE','headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'id':_0x4aaf61})});if(_0x5558cb['ok'])showInfoAlert(translate[lang]['announcementDeleted']),await _init(InitMode['HALF_INIT']);else{if(_0x5558cb['status']===0x194)showInfoAlert(translate[lang]['announcementNotFound']);else throw new Error(translate[lang]['serverResponseError']);}}catch(_0x37ef07){console['error']('خطا\x20در\x20اتصال\x20به\x20سرور:\x20',_0x37ef07),showInfoAlert(translate[lang]['connectionFailed']);}});}document['getElementById']('announcement-form')['addEventListener']('submit',async _0x10f5ae=>{_0x10f5ae['preventDefault']();const _0x38ff5e=crypto['randomUUID'](),_0x5475ce=document['getElementById']('announcement-message')['value']['trim'](),_0x2939d2={'term_id':currentTerm['id'],'group_id':currentUser['group'],'message':_0x5475ce,'id':_0x38ff5e};try{const _0x260e25=await fetch('/api/announcements/add',{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON['stringify'](_0x2939d2)});if(!_0x260e25['ok'])throw new Error(translate[lang]['serverResponseError']);showInfoAlert(translate[lang]['announcementAdded']),closeAnnouncementDialog(),await _init(InitMode['HALF_INIT']);}catch(_0x41b94f){console['error']('خطا\x20در\x20اتصال\x20به\x20سرور:\x20',_0x41b94f),showInfoAlert(translate[lang]['connectionFailed']);}});const programDialog=document['getElementById']('program-dialog'),programType=document['getElementById']('program-type');document['getElementById']('add-program-btn')['addEventListener']('click',()=>{programDialog['classList']['remove']('hidden');const _0x304703=programDialog['querySelector']('form');_0x304703['noValidate']=![];});function closeProgramDialog(){programDialog['classList']['add']('hidden');const _0x5ecc9e=programDialog['querySelector']('form');_0x5ecc9e['noValidate']=!![],_0x5ecc9e['reset'](),programType['dispatchEvent'](new Event('change'));}function updateInputType(){const _0x106e22=document['getElementById']('program-day'),_0x5f205f=document['getElementById']('program-start'),_0x378dec=document['getElementById']('program-end'),_0x206060=programType['value'],_0x3c9964=new Date(),_0x33f613=new Date(_0x3c9964['getTime']()-_0x3c9964['getTimezoneOffset']()*0xea60)['toISOString']()['slice'](0x0,0x10);if(_0x206060==='weekly')_0x106e22['value']='',_0x106e22['disabled']=![],_0x106e22['classList']['remove']('hidden'),_0x5f205f['type']='time',_0x5f205f['placeholder']=translate[lang]['startTime'],_0x378dec['placeholder']=translate[lang]['endTime'],_0x5f205f['removeAttribute']('min');else _0x206060==='one-time'&&(_0x106e22['value']='',_0x106e22['disabled']=!![],_0x106e22['classList']['add']('hidden'),_0x5f205f['type']='datetime-local',_0x5f205f['placeholder']=translate[lang]['startDate'],_0x378dec['placeholder']=translate[lang]['endTime'],_0x5f205f['min']=_0x33f613);_0x5f205f['value']='',_0x378dec['value']='';}function validateTimeRange(){const _0x304a80=document['getElementById']('program-start')['value'],_0x2fda24=document['getElementById']('program-end')['value'],_0x2ad907=programType['value'];let _0x5e4008,_0x12cd5c;_0x2ad907==='one-time'?(_0x5e4008=_0x304a80,_0x12cd5c=_0x304a80['split']('T')[0x0]+'T'+_0x2fda24):(_0x5e4008='2000-01-01T'+_0x304a80,_0x12cd5c='2000-01-01T'+_0x2fda24);const _0x2df577=new Date(_0x5e4008),_0x296ad5=new Date(_0x12cd5c);if(_0x2df577>=_0x296ad5)return showInfoAlert(translate[lang]['endAfterStart']),![];return!![];}async function deleteProgram(_0x57ca98){showYesOrNoAlert(translate[lang]['confirmDeleteProgram'])['then'](async _0x3ea715=>{if(!_0x3ea715)return;try{const _0x1e5209=await fetch('/api/programs/delete',{'method':'DELETE','headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'id':_0x57ca98})});if(_0x1e5209['ok'])showInfoAlert(translate[lang]['programDeleted']),await _init(InitMode['HALF_INIT']);else{if(_0x1e5209['status']===0x194)showInfoAlert(translate[lang]['programNotFound']);else throw new Error(translate[lang]['serverResponseError']);}}catch(_0x5e5284){console['error']('خطا\x20در\x20اتصال\x20به\x20سرور:\x20',_0x5e5284),showInfoAlert(translate[lang]['connectionFailed']);}});}document['getElementById']('program-form')['addEventListener']('submit',async _0x56bc71=>{_0x56bc71['preventDefault']();if(!validateTimeRange())return;const _0x66a5bb=crypto['randomUUID'](),_0x3e1af0=document['getElementById']('program-title')['value'],_0x9be5e9=document['getElementById']('program-group')['value'],_0x437f76=document['getElementById']('program-host')['value'],_0x2392ea=programType['value'],_0x54ef8c=document['getElementById']('program-day')['value'],_0x2851c3=document['getElementById']('program-start')['value'],_0x427b31=document['getElementById']('program-end')['value'],_0x55b9b4=document['getElementById']('program-place')['value'],_0xb89f01={'term_id':currentTerm['id'],'group_id':currentUser['group'],'id':_0x66a5bb,'title':_0x3e1af0,'group_number':_0x9be5e9,'host':_0x437f76,'type':_0x2392ea,'day':_0x54ef8c,'start':_0x2851c3,'end':_0x427b31,'place':_0x55b9b4};try{const _0x9b5934=await fetch('/api/programs/add',{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON['stringify'](_0xb89f01)});if(!_0x9b5934['ok'])throw new Error(translate[lang]['serverResponseError']);showInfoAlert(translate[lang]['programAdded']),closeProgramDialog(),await _init(InitMode['HALF_INIT']);}catch(_0x59220f){console['error']('خطا\x20در\x20اتصال\x20به\x20سرور:\x20',_0x59220f),showInfoAlert(translate[lang]['connectionFailed']);}});function renderScheduleTables(_0x175373){_0x175373['events']['forEach'](_0x3a992a=>{const _0x7d6bf=document['querySelector']('#'+_0x3a992a['type']+'-list\x20tbody'),_0x2a9454=document['createElement']('tr');_0x2a9454['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3a992a['title']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3a992a['group_number']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3a992a['host']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x3a992a['day']?'<td>'+_0x3a992a['day']+'</td>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3a992a['start']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3a992a['end']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x3a992a['place']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22deleteProgram(\x27'+_0x3a992a['id']+'\x27)\x22>حذف</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x7d6bf['appendChild'](_0x2a9454);});const _0x49e6d3=document['querySelector']('#announcement-list\x20tbody');_0x175373['announcements']['forEach'](_0x279a90=>{const _0x5da621=document['createElement']('tr');_0x5da621['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x279a90['message']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22deleteAnnouncement(\x27'+_0x279a90['id']+'\x27)\x22>'+translate[lang]['delete']+'</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x49e6d3['appendChild'](_0x5da621);});}async function _init(_0x1094fb){if(_0x1094fb===InitMode['FULL_INIT']){currentUser={'username':document['getElementById']('expert-username')['textContent'],'group':document['getElementById']('expert-group')['textContent']};const _0x49bc4d=document['getElementById']('expert-group');_0x49bc4d['textContent']=allGroups['find'](_0x7138ea=>_0x7138ea['id']==currentUser['group'])?.['name']||translate[lang]['noGroup'],await loadCurrentTerm();}['weekly','one-time']['forEach'](_0x360bd4=>{const _0x104bb3=document['querySelector']('#'+_0x360bd4+'-list\x20tbody');_0x104bb3['innerHTML']='';});const _0x30acd7=document['querySelector']('#announcement-list\x20tbody');_0x30acd7['innerHTML']='';if(currentTerm){const _0x45877b=await loadScheduleContent(currentUser['group']);renderScheduleTables(_0x45877b);}}((async()=>{const {groups:_0x415959}=await loadGroups();allGroups=_0x415959,await _init(InitMode['FULL_INIT']),updateInputType(),programType['addEventListener']('change',updateInputType),updateTime(),setInterval(updateTime,0x3e8);})());